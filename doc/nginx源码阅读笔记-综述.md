## nginx源码阅读笔记-综述

nginx作为一个高性能web服务器，十分值得做后台服务器开发人员的学习。重点需要关注的是nginx的启动以及进程模型、事件模块中的epoll模块、负载均衡以及整体的框架。推荐书籍《深入理解nginx》。

### nginx的启动

nginx的整个启动过程是围绕着ngx_cycle_t结构体进行的，并且nginx是高度模块化的，且启动是通过配置启动项进行启动。在启动过程中，各模块通过读取感兴趣的配置文件，并且保存到结构体里面。进行启动的准备工作。<br>

### nginx的多进程模型

首先要明确的是nginx是异步非阻塞多进程模型，并且进程数通常等于cpu的核数。通常nginx有一个主进程master以及多个worker进程。多个连接对应一个worker进程，并且master进程它是可以管理着worker进程的启动、关闭、重新读取配置文件和平滑升级的功能。

apache是同步多进程模型，我们都知道的是同步与异步的区别在于同步cpu会阻塞等待请求的完成，而异步不会去等待请求的完成，效率更高。那么为什么不去用多线程的模型呢，因为现在一般是多核，如果是单核的话，那么肯定多线程要效率高。线程之间是共享资源的，故而在线程之间更换时，就需要将一个核心的资源拷贝到另外一个核心，效率就会很受影响。<br>

### nginx的事件模块



### 负载均衡

nginx一共在两个地方用到了负载均衡。第一种是当有着大量请求连接到来时，为了确保不要有有的worker进程超载，而有的worker进程空闲。这就用到了nginx的负载均衡。对于每个worker设置一个最大请求连接数，当请求达到一定数值时，就不在接受新的连接。

另外一种是nginx作为反向代理的时候，nginx管理着很多台服务器，那么当nginx接收到请求时，如何区分发这些请求呢？一般采用加权轮询、IP哈希这两种方式。

### 整体架构

nginx即可以处理静态请求，也可以处理动态请求。但是当处理动态请求的效果不如apache的效果好。因此nginx常常作为web静态服务器和反向代理服务器。具体的可以看《深入了解nginx》。以下的图来自于此书的架构图：

![ninx架构图](C:\Users\hukai\Desktop\airia\nginx\ninx架构图.png)